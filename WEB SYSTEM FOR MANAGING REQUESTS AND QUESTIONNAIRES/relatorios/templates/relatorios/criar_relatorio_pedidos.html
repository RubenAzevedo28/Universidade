{% extends 'app.html' %}
{% block title %}Relatório de Pedidos{% endblock %}

{% block content %}
<div class="container" style="margin-top: 20px;">
    <form method="GET" action="" style="text-align: center; margin-bottom: 20px;">
        <div style="display: inline-block; margin-right: 20px;">
            <label for="data_inicio">Data de Início:</label>
            <input type="date" id="data_inicio" name="data_inicio" required>
        </div>
        <div style="display: inline-block; margin-right: 20px;">
            <label for="data_fim">Data de Fim:</label>
            <input type="date" id="data_fim" name="data_fim" required>
        </div>
        <button type="submit" style="padding: 10px 20px; font-size: 16px;">Filtrar</button>
    </form>

    <h2 style="margin-bottom: 20px; text-align: center;"><b>Relatório de Pedidos</b></h2>

<div style="text-align: center; margin-bottom: 20px;">
    <button onclick="imprimirRelatorio()" style="margin-right: 10px; padding: 10px 20px; font-size: 16px;"><i class="fas fa-print"></i>
        Imprimir</button>
    <button
        onclick="window.location.href='{% url 'relatorios:exportar-pedidos-csv' %}?data_inicio={{ request.GET.data_inicio }}&data_fim={{ request.GET.data_fim }}'"
        style="margin-right: 10px; padding: 10px 20px; font-size: 16px;"><i class="fas fa-download"></i> Exportar
        CSV</button>
    <button
        onclick="window.location.href='{% url 'relatorios:exportar-pedidos-pdf' %}?data_inicio={{ request.GET.data_inicio }}&data_fim={{ request.GET.data_fim }}'"
        style="padding: 10px 20px; font-size: 16px;"><i class="fas fa-file-pdf"></i> Exportar PDF</button>
</div>

    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
        <thead>
            <tr>
                <th style="padding: 10px; background-color: #f2f2f2; border-bottom: 2px solid #ddd;">Assunto</th>
                <th style="padding: 10px; background-color: #f2f2f2; border-bottom: 2px solid #ddd;">Informações</th>
                <th style="padding: 10px; background-color: #f2f2f2; border-bottom: 2px solid #ddd;">Data Alvo</th>
                <th style="padding: 10px; background-color: #f2f2f2; border-bottom: 2px solid #ddd;">Estado</th>
                <th style="padding: 10px; background-color: #f2f2f2; border-bottom: 2px solid #ddd;">Data de Submissão</th>
                <th style="padding: 10px; background-color: #f2f2f2; border-bottom: 2px solid #ddd;">Data Validação</th>
                <th style="padding: 10px; background-color: #f2f2f2; border-bottom: 2px solid #ddd;">Tipo de Pedido</th>
                <th style="padding: 10px; background-color: #f2f2f2; border-bottom: 2px solid #ddd;">Proponente</th>
                <th style="padding: 10px; background-color: #f2f2f2; border-bottom: 2px solid #ddd;">Comentários</th>
            </tr>
        </thead>
        <tbody>
            {% for pedido in pedidos %}
            <tr class="{% cycle 'linha-par' 'linha-impar' %}"style="{% cycle 'background-color: #fff;' 'background-color: #f9f9f9;' %}">
                <td style="text-align: center; padding: 10px; border-bottom: 1px solid #ddd;">{{ pedido.assunto }}</td>
                <td style="text-align: center; padding: 10px; border-bottom: 1px solid #ddd;">{{ pedido.informacoes }}</td>
                <td style="text-align: center; padding: 10px; border-bottom: 1px solid #ddd;">{{ pedido.data_de_alvo|date:"Y-m-d" }}</td>
                <td style="text-align: center; padding: 10px; border-bottom: 1px solid #ddd;">{{ pedido.estado }}</td>
                <td style="text-align: center; padding: 10px; border-bottom: 1px solid #ddd;">{{ pedido.data_de_submissao|date:"Y-m-d" }}</td>
                <td style="text-align: center; padding: 10px; border-bottom: 1px solid #ddd;">{{ pedido.data_validacao|date:"Y-m-d" }}</td>
                <td style="text-align: center; padding: 10px; border-bottom: 1px solid #ddd;">{{ pedido.tipo_pedido }}</td>
                <td style="text-align: center; padding: 10px; border-bottom: 1px solid #ddd;">{{ pedido.proponente }}</td>
                <td style="text-align: center; padding: 10px; border-bottom: 1px solid #ddd;">{{ pedido.comentarios }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<div id="printInstructions"
    style="display:none; position:fixed; top:10%; left:10%; right:10%; background-color:white; border:1px solid #ddd; padding:20px; box-shadow:0px 0px 10px rgba(0,0,0,0.5); z-index:1000;">
    <p>Para salvar este relatório como PDF:</p>
    <ol>
        <li>Na janela de impressão, selecione "Guardar como PDF" como destino.</li>
        <li>Confirme as opções de impressão.</li>
        <li>Clique em "Guardar".</li>
    </ol>
    <button onclick="document.getElementById('printInstructions').style.display='none'; window.print();">Entendi,
        continuar</button>
</div>
<script>
    function exportarDados() {
        document.getElementById('printInstructions').style.display = 'block';
    }

    function imprimirRelatorio() {
        window.print();
    }
</script>
{% endblock %}