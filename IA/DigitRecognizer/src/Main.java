import java.io.*;
import java.util.*;

public class Main {

    private static final double LEARNING_RATE = 0.7;
    private static final int ITERATIONS = 150;
    private static final double TRAINING_PERCENTAGE = 0.8;

    public static void main(String[] args) throws IOException {
        //runTraining();
        runIterative();
    }

    public static void runTraining() throws IOException {
        // Load dataset
        String datasetPath = "dataset/dataset.csv";
        String labelsPath = "dataset/labels.csv";
        double[][] data = loadCSVData(datasetPath, 400); // Assuming 400 columns per row
        double[] labels = loadCSVLabels(labelsPath);

        // Normalize data
        normalizeData(data);

        // Split dataset into training and testing sets
        int trainingSize = (int) (data.length * TRAINING_PERCENTAGE);
        double[][] trainingData = Arrays.copyOfRange(data, 0, trainingSize);
        double[] trainingLabels = Arrays.copyOfRange(labels, 0, trainingSize);
        double[][] testingData = Arrays.copyOfRange(data, trainingSize, data.length);
        double[] testingLabels = Arrays.copyOfRange(labels, trainingSize, labels.length);

        // Initialize weights
        double[] neuron1Weights = initializeWeights(401);
        double[] neuron2Weights = initializeWeights(2);

        // Create and train the network
        NeuralNetwork network = new NeuralNetwork(neuron1Weights, neuron2Weights);
        network.train(trainingData, trainingLabels, testingData, testingLabels, ITERATIONS, LEARNING_RATE);

        // Test the network
        network.test(testingData, testingLabels);
    }

    private static double[][] loadCSVData(String path, int columns) throws IOException {
        BufferedReader reader = new BufferedReader(new FileReader(path));
        List<double[]> dataList = new ArrayList<>();
        String line;

        while ((line = reader.readLine()) != null) {
            String[] values = line.split(",");
            if (values.length != columns) {
                throw new RuntimeException("Error: Expected " + columns + " columns, but found " + values.length);
            }
            double[] row = Arrays.stream(values).mapToDouble(Double::parseDouble).toArray();
            dataList.add(row);
        }
        reader.close();

        double[][] data = new double[dataList.size()][columns];
        for (int i = 0; i < dataList.size(); i++) {
            data[i] = dataList.get(i);
        }
        return data;
    }

    private static double[] loadCSVLabels(String path) throws IOException {
        BufferedReader reader = new BufferedReader(new FileReader(path));
        List<Double> labelsList = new ArrayList<>();
        String line;

        while ((line = reader.readLine()) != null) {
            labelsList.add(Double.parseDouble(line));
        }
        reader.close();

        double[] labels = new double[labelsList.size()];
        for (int i = 0; i < labelsList.size(); i++) {
            labels[i] = labelsList.get(i);
        }
        return labels;
    }

    private static void normalizeData(double[][] data) {
        double min = Double.MAX_VALUE;
        double max = Double.MIN_VALUE;

        // Find global min and max
        for (double[] row : data) {
            for (double value : row) {
                if (value < min) min = value;
                if (value > max) max = value;
            }
        }

        // Apply min-max normalization
        for (double[] row : data) {
            for (int i = 0; i < row.length; i++) {
                row[i] = (row[i] - min) / max - min;
            }
        }
    }

    private static double[] initializeWeights(int size) {
        double[] weights = new double[size];
        Random rand = new Random();
        for (int i = 0; i < size; i++) {
            weights[i] = rand.nextDouble() - 0.5;
        }
        return weights;
    }

////////////////////////////////////-------------------------------------------------------Main_Iterative------------------------------------------------------------------\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
    public static void runIterative() throws IOException {
        // Pre-trained weights hardcoded (example values, replace with actual weights)
        double[] bestWeightsNeuron1 = {
                0.5210354859949726,-0.26330908742947945,0.2461297631025199,-0.4680938740277191,0.17332505546658208,0.08880761368656212,-0.4441748062772849,0.24281937394380618,-0.12803054456063365,0.18205692112798524,-0.012841837063065957,-0.20539298259662173,0.2383729793247147,0.23296013317592015,0.07447133629621484,0.21114273001406572,-0.3148905132295129,0.09029173982293481,-0.32793780224433666,-0.45455227536717224,0.011902018416193967,-0.2009957829985984,0.0013262233639019338,0.20395382373678442,-0.24564710937246986,-0.34714533226548405,0.08825153195808424,-0.443030882289985,0.2621512244013093,0.30558680778346775,0.25414606239889664,0.39021692493656857,-0.1694625933769355,0.11377116087414631,0.08981885120010631,-0.255141368822396,-0.010633138157037899,0.5127858783329164,0.3850312966310982,0.21731361250472606,-0.37853434860393,-0.08968803743226886,-0.16347980022580808,-0.14592891882668466,-0.07586180384526023,0.24509768464794127,-0.07718056674991816,0.34065860993748304,0.3491584793427895,0.1271579204643064,0.28995635954820453,0.34360048526897563,-0.4251954364236333,0.17660226734406356,0.06096307075426266,0.415598526431977,0.21172172352038815,0.08083230391664184,0.17758634691377398,0.3380400984715558,-0.3882965362930394,-0.44066467965426126,0.1277846069113982,-0.1308595309454365,-0.16575068136867344,0.31969030235742885,0.12414071744814932,0.019222927131707913,-0.171372445607751,0.1661226720200116,0.3673651015162044,-0.24870140188426554,-0.41231246568952096,0.05749552857794549,0.4008791088855792,-0.48913023815265627,-0.21229992192747918,0.10293065648387702,0.44918665093075105,-0.015607059140080896,0.16130786469366634,-0.39702585741104135,0.2186520123221423,-0.10029785771126072,0.2307039183945405,-0.2537105288010719,-0.41079851786449656,-0.010009487106176851,0.10307663998127624,-0.6073636739669326,-0.5018861104163621,-0.06802152288440241,-0.38004758703835845,-0.0307586948681188,-0.560012012516249,-0.37773760949011476,-0.28401020768931906,0.14004015211109583,-0.42012715426417724,-0.10940264286784042,0.28625762500761104,-0.3738435306871012,0.35544374964807385,-0.41011593176028643,0.4243133242141364,0.139600656258299,-0.3536086314233146,-0.476639980586658,-0.035745772566782325,0.24775138396428614,0.09118334545219725,0.25700392016903695,-0.5846785112266488,-0.6873006968195703,-0.5093230405264463,-0.21145489889950234,0.1501312026148842,0.5306370440752003,-0.42603995277011414,0.16579239863504996,0.37962202242985527,-0.08649457175408351,0.1219821157575315,-0.19652213747741681,0.35448125499680677,0.4069344263557319,0.49192528092158977,-0.11418306211851752,-0.27956838128380257,-0.4571550615356063,0.002212503638251885,-0.6942272222077633,-0.8286914005955651,-0.3133462517414061,-0.16509303128151462,-0.33772902922413944,0.5413152848229587,-0.4054026827338592,0.26706353471980426,-0.015172545122380915,-0.08747178092470377,-0.15379125692388715,0.029739288431991005,-0.18930340080254954,-0.19769472820135914,0.1834199918344564,0.2300842949127124,-0.24102792215690094,-0.4326818884696027,0.004328035949418291,-0.4095756154694479,-0.23146716478238685,-0.6900021454034091,-0.06584435492787084,-0.499065429178644,0.348464664246849,-0.765965505041252,0.2041419241991746,0.11092534484536941,-0.41432765925107434,0.15161174049052972,-0.14123566948230468,0.17849619786207796,-0.04048501922218353,0.25034672194423313,-0.20106807565836357,-0.2489758684597588,0.04780692601673991,-0.2809665403043691,0.2021386564787708,-0.5750927397320472,-0.8753622537620769,-0.6387125696403702,0.19497268198976722,-0.2701310718296716,0.43495442791899097,-0.5427262516937063,-0.5486152907453852,-0.3087386450448857,0.16865141177144943,-0.3715902524970873,-0.43218422576171,-0.4460882936889893,0.06834356596131434,-0.21804473543902875,0.13393969356771007,0.30755049909074456,0.03975737337656839,-0.3178374558291658,0.3648607597539164,0.4876692693232322,0.8462842470035619,0.8961196974218418,0.8712866124544691,0.2028681465281874,0.6679710147843898,-0.8238547277408154,-0.6112826142753428,0.2434171742345017,0.38747488938870506,-0.12511690416354299,0.3190793725857827,0.5095055395426821,0.009428925161549884,-0.16857715405664964,-0.10669963148456202,-0.24340147575999221,0.15629914717683674,0.24377878333380093,0.6605860262138334,1.0925918490414714,1.2483284772152252,1.0826031005994488,0.09406138813100622,0.631107573416257,0.5665639292162269,-0.5207060048286593,-0.4556525983969863,-0.31065552291082127,-0.3399692031333479,-0.37014141117657867,0.18840431846779018,0.5267034407487706,0.009999765437168668,-0.5325528242977571,0.3506864555311502,0.2590306545075511,-0.4161742100138429,-0.10578900571167303,0.8100227997096482,0.34787341983440895,0.5264936878598857,-0.07121807074192466,0.04526028204361976,-0.25365762495048105,-0.07240029134103036,0.2264563743570351,-0.3257027073135978,0.2427388199749211,-0.03219062086063507,0.3155090037764509,0.41929628422796483,0.18859097484879464,0.2942872688896556,-0.09166591925360018,-0.042631748233624985,-0.08805898083088684,-0.2885972943751696,-0.3046819816961839,0.10381255936293386,0.18449109138131373,-0.46538189495558807,-0.7327048305700912,-0.7486776107908765,-0.21939891550982912,-0.17529225615824373,0.11344529148044263,0.4945051149061216,-0.31372320091408523,-0.30719172173702236,0.07182174237737243,0.3817735334303619,0.43784179556424757,0.07170822788095761,0.09891575554658193,0.023407233648121452,0.08560652457957586,-0.007619442451685808,0.06642927970202851,-0.6042819604068432,0.23920056422137784,-0.14500014424899063,0.05524538835276981,0.28796088974839457,0.2843292145836717,0.5113769443570335,0.13599669327378267,-0.4571395514566537,-0.10321125426489816,0.5303645523588242,0.07860565105997538,0.3962144697687956,0.05130499415260714,-0.32886423342204635,0.48845743504256234,-0.02886271281997299,0.15596895940092867,-0.007361102068423434,-0.05840316865149304,-0.5419752072465557,-0.6375630176049225,-0.6216443187328473,-0.6542034243792672,-0.013961983960442733,-0.24578659606043987,0.6143346573596004,0.25919538800098446,0.05611664790631845,-0.13180434249517745,0.09789411497671013,0.16557963839903925,0.18089377236920515,0.3036189755238729,0.3899670502900616,-0.035043734454851316,-0.2697371221818808,0.1698979061402134,-0.6806743687567295,-0.5057900550531745,-0.2097722161878925,-0.06126355545148408,-0.14702710118616133,-0.5125157819180175,0.2513287146374519,0.22446547581179188,0.35390980388249965,0.18408838108810802,0.35433546851379,-0.42857036290689254,-0.44366432517366405,-0.04181337471445981,0.25319372816439367,0.10695998381275096,-0.3418923983192812,0.2989885183135259,0.450893882513899,-0.36403555716207353,0.1484145177498779,0.1679429997161244,-0.19929058987312867,-0.5004334253965685,0.01759357409413686,-0.2949893702177332,0.049300589325430806,0.0665576314863589,-0.020965302914195752,0.3294135199777689,0.1270443969939468,-0.3584068047798031,0.15812865753410552,-0.07587451825063588,0.3420166848864501,0.03172077512335148,-0.212271398332322,0.10158112899404327,-0.35443498438519755,-0.0641345158607093,0.39317563287135077,-0.5149278530936222,-0.2378111537313384,0.039548179690427225,0.33688141817322353,-0.5166394265608624,0.39737266476669286,0.46040212069874226,-0.38033268335723247,-0.06953156895812496,0.4968545097957452,-0.33946672243521425,-0.0017103812075501173,-0.28146051450439713,-0.24728718152796064,-0.21907734693845676,-0.004648356713068385,0.205228690489091,-0.4226825362968174,-0.2524847192879362,-0.27530884493097446,0.437287179571949,-0.06454982338706662,-0.09498272427258996,-0.426446551597249,-0.03116769338266454,0.20105666743809894,-0.22970416823658207,-0.41738201084027965,0.30146938723692407,0.32831602295770346,0.3039949277065342,0.05183261578123817,0.16445200126827456,-0.334122457963244,0.4190943982812737,-0.1780395421996874,0.32453788265743955,-0.09672561490156956,0.03254783731501011,-0.28679490537198804,0.37444477386624964,0.23334740801379442,-0.2629901910810105,-0.3882564092501171,0.03613056445454464,0.0020262502946987782,0.20320290030285795,-0.35948929986899897,-0.2637058001656942,-0.30790922360090106,-0.17054575002805084,0.1496732852849245,0.04975459575353057        };
        double[] bestWeightsNeuron2 = {
                -4.301600314968602,8.909051037041573
        };

        NeuralNetwork network = new NeuralNetwork(bestWeightsNeuron1, bestWeightsNeuron2);

        // Read input from standard input
        BufferedReader reader = new BufferedReader(new InputStreamReader(System.in));
        String line = reader.readLine();

        // Parse input
        String[] values = line.split(",");
        if (values.length != 400) {
            throw new RuntimeException("Error: Expected 400 inputs, but received " + values.length);
        }

        double[] input = Arrays.stream(values).mapToDouble(Double::parseDouble).toArray();

        // Normalize the input
        double min = Double.MAX_VALUE;
        double max = Double.MIN_VALUE;

        for (double value : input) {
            if (value < min) min = value;
            if (value > max) max = value;
        }

        for (int i = 0; i < input.length; i++) {
            input[i] = (input[i] - min) / max - min;
        }

        // Compute the output using the neural network
        double output = network.computeOutput(input);
        int binaryOutput = output >= 0.5 ? 1 : 0;

        // Print the result
        System.out.println(binaryOutput);
        //System.out.println(output);
    }

}
